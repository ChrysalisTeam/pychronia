<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
{% load sekizai_tags kwacros %}

<html xmlns="http://www.w3.org/1999/xhtml">
<head>

    <title>{% block html_title %}Bienvenue{% endblock %}</title>

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    {% render_block "meta" %}


    <link href="{{ STATIC_URL }}img/favicon_diamond.png" rel="shortcut icon" type="image/png" />
    <link href="{{ STATIC_URL }}libs/fancybox/jquery.fancybox.css" rel="stylesheet" type="text/css" />
    <link href="{{ STATIC_URL }}libs/fasw.transitions/transition.css" rel="stylesheet" type="text/css"/>
    <link href="{{ STATIC_URL }}libs/jquery-jplayer-2.3.0/blue.monday/jplayer.blue.monday.css" rel="stylesheet" type="text/css"/>
    {% render_block "css" %}

    <link href="{{ STATIC_URL }}MetalRadiance/metalradiance.css" rel="stylesheet" type="text/css" /><!-- MUST BE LAST -->

    <script src="{{ STATIC_URL }}libs/jquery-1.9.1.js" type="text/javascript"></script>
    <script src="{{ STATIC_URL }}libs/jquery-migrate-1.1.0.min.js" type="text/javascript"></script>
    <script src="{{ STATIC_URL }}libs/jquery.cookie.js" type="text/javascript"></script>
    <script src="{{ STATIC_URL }}libs/jquery-storage/jquery.storage.js" type="text/javascript"></script>
    <script src="{{ STATIC_URL }}libs/jquery-ui/jquery-ui-1.10.0.custom.js" type="text/javascript"></script>
    <script src="{{ STATIC_URL }}libs/jquery.dropmenu-1.1.4-edited.js" type="text/javascript"></script>
    <script src="{{ STATIC_URL }}libs/fancybox/jquery.fancybox.js" type="text/javascript"></script>
    <script src="{{ STATIC_URL }}libs/jquery.css3finalize-v3.x.min.js" type="text/javascript"></script>
    <script src="{{ STATIC_URL }}libs/jquery.pulsate.js" type="text/javascript"></script>
    <script src="{{ STATIC_URL }}libs/jquery-disabler.js" type="text/javascript"></script>
    <script src="{{ STATIC_URL }}libs/fasw.transitions/fasw.transitions.js" type="text/javascript"></script>
    <script src="{{ STATIC_URL }}libs/jquery-jplayer-2.3.0/jquery.jplayer.min.js" type="text/javascript"></script>
    <script src="{{ STATIC_URL }}libs/jquery-jplayer-2.3.0/add-on/jplayer.playlist.min.js" type="text/javascript"></script>
    {% render_block "js" %}


    <script language="javascript" type="text/javascript">
        /* here put JS that must be executed only on PAGE LOAD, not fast transitions */
        var JS_TIMER_START = setTimeout(function(){}, 0);


      var xhrPool = [];
      $(document).ajaxSend(function(e, jqXHR, options){
        xhrPool.push(jqXHR);
      });
      $(document).ajaxComplete(function(e, jqXHR, options) {
        xhrPool = $.grep(xhrPool, function(x){return x!=jqXHR});
      });
      var abort_pending_ajax_requests = function() {
        $.each(xhrPool, function(idx, jqXHR) {
          jqXHR.abort();
        });
      };

       /*
      var oldbeforeunload = window.onbeforeunload;
      window.onbeforeunload = function() {
        var r = oldbeforeunload ? oldbeforeunload() : undefined;
        if (r == undefined) {
          // only cancel requests if there is no prompt to stay on the page
          // if there is a prompt, it will likely give the requests enough time to finish
          abort_pending_ajax_requests();
        }
        return r;
      }*/



     function clear_all_js_timeouts() {

         var maxId = setTimeout(function(){}, 0);
         var i;

         for(i=JS_TIMER_START; i <= maxId; i+=1) {
            //console.log("CLEARING TIMER "  + i);
            clearTimeout(i);
        }

        JS_TIMER_START = i; // value of the FIRST next timer created
     }


    function CLEANUP_PENDING_JS_WORKFLOWS () {
        abort_pending_ajax_requests(); // beware, might trigger completion events anyway
        clear_all_js_timeouts();
    }

    </script>

    {% block html_headers %}
    {% endblock %}

    {% block sekizai_calls %}
        <!-- block solely used to place sekizai calls in sub-templates, must always call "block.super" -->
    {% endblock %}

</head>
<body bgcolor="black">

    {% block body_top %}{% endblock %}


    <div id="full_header">

        <div id="full_header_background">

        	<div id="full_header_center">

	            {% block notification_banners %}{% endblock %}

	            <div id="title_table">
	                {% block top_left_motto %}<div class="motto left_image"></div>{% endblock %}
	                <div id="site_title">
	                    {% block site_title %}
	                    <a href="/"><img src="{{ STATIC_URL }}MetalRadiance/img/titles/chrysalis.png"/></a></div>
	                    {% endblock %}
	                {% block top_right_motto %}<div class="motto right_image"></div>{% endblock %}
	            </div>

	            <div id="notification_table">
	                <div class="carving">{% block carving_left %}{% endblock %}</div>
	                <div class="separator"></div>
	                <div class="carving">{% block carving_right %}{% endblock %}</div>
	            </div>

            </div>
        </div>

    </div>



    <div id="full_menu">
        <div id="main_menu">
            {% block left_big_icon_panel %}
            <div class="big_icon_panel">
                {% block left_big_icon_img %}
                <img src="{{ STATIC_URL }}MetalRadiance/img/icons/speaker.png"/>
                {% endblock %}
            </div>
            {% endblock %}

            <div class="marble_menu_container">
                <div class="marble_menu">
                        <ul id="menulist" class="dropmenu" style="z-index: 100;">
                            {% block main_menu %}
                            {% endblock %}
                        </ul>
                </div>
            </div>

            {% block right_big_icon_panel %}
            <div class="big_icon_panel">
                {% block right_big_icon_img %}
                <img src="{{ STATIC_URL }}MetalRadiance/img/icons/question_mark.png"/>
                {% endblock %}
            </div>
            {% endblock %}
        </div>
    </div>



    <div id="full_content">
        {% block panels %}{% endblock %}
    </div>


    {% block up_footer %}
    <div id="up_footer_wrapper">

            <div id="up_footer_border_left">
                {% block up_footer_left_content %}
                <div>
                &nbsp;
                </div>
                {% endblock %}
            </div><!-- NO SPACE HERE --><div id="up_footer_border_center"> &nbsp;
                <img class="footer_center_img" src="{{ STATIC_URL }}MetalRadiance/img/icons/pegasus_medal.png"/>
            </div><!-- NO SPACE HERE --><div id="up_footer_border_right">
                {% block up_footer_right_content %}
                <div>
                &nbsp;
                </div>
                {% endblock %}
            </div>

    </div>
    {% endblock %}


    {% block low_footer %}
    <div id="low_footer_wrapper">
        <div id="low_footer_border">
            {% block low_footer_content %}
                STUFF
            {% endblock %}
        </div>
    </div>
    {% endblock %}


    {% block bottom_padding %}
    <br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>
    {% endblock %}




    <script language="javascript" type="text/javascript">

    {% render_block "definition_js" %}





     INIT_JS = function() {

            if (typeof my_fast_transitions == 'undefined' && 0) {  // JS PAGE TRANSITIONS DISABLED ATM
                my_fast_transitions = new ft({ /* data-ftrans attr must be set to slide/slideup/slidedown/fade/flip/pop */
                        "navB" : "",   //Effect for navigation button, leave it empty to disable it
                        "but" : false,           //Flag to enable transitions on button, false by default
                        "cBa" : INIT_JS,      //callback function, with newly defined body
                }); // nifty javascript transitions between pages
            }

            $('#menulist').dropmenu(
                {
                    effect          : "slide",       //  "slide", "fade", or "none"
                    speed           : "fast", //  "normal", "fast", "slow", 100, 1000, etc
                    timeout         : 400,
                    nbsp            : true,
                    maxWidth        : 0
                }
            );

            /* only half working parralax system

            window.onscroll = function() {

                    var speed = 0.6;
                    var posX = Math.floor(window.pageXOffset * speed);
                    var posY = Math.floor(window.pageYOffset * speed);

                    $("body").css("background-position", posX + "px " + posY + "px");
                }
            */

           /* sign that parts of the page are for admins only */
           $(".admin-note").pulsate({
                              color: "#9D8126",                       // set the color of the pulse
                              reach: 8,                              // how far the pulse goes in px
                              speed: 1000,                            // how long one pulse takes in ms
                              pause: 500,                               // how long the pause between pulses is in ms
                              glow: true,                             // if the glow should be shown too
                              repeat: true,                           // will repeat forever if true, if given a number will repeat for that many times
                              onHover: false                          // if true only pulsate if user hovers over the element
                            });

           /*
           $("form").disabler({ // FIXME - ALL disabled container must have an ID !! Let's create it on demand!!
              disable : true
            });*/


            {% render_block "onload_js" %}

        }

       $(document).ready(INIT_JS); // only called on full page loading, not on ajax-based fast-transitions
    </script>

</body>
</html>